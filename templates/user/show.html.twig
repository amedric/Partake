{% extends 'base.html.twig' %}

{% block title %}Profile{% endblock %}

{% block header %}
    <div class="ptk-profileContainer">
        <div class="ptk-profileTitleContainer">
            <h1 class="ptk-profileHeader">Profile</h1>
            <h1 class="ptk-profileHeader">Profile</h1>
        </div>
        <div class="ptk-profileDetailsContainer">
            <div class="ptk-profileDetailsLeft">
                <div class="ptk-profileDetailsRow">
                    <p class="ptk-profileLabels">Firstname:</p>
                    <p class="ptk-profileDetails">{{ user.firstname }}</p>
                </div>
                <div class="ptk-profileDetailsRow">
                    <p class="ptk-profileLabels">Lastname:</p>
                    <p class="ptk-profileDetails">{{ user.lastname }}</p>
                </div>
                <div class="ptk-profileDetailsRow">
                    <p class="ptk-profileLabels">Department:</p>
                    <p class="ptk-profileDetails">{{ user.category.title }}</p>
                </div>
            </div>
            <div class="ptk-profileDetailsRight">
                <div class="ptk-profileDetailsRow">
                    <p class="ptk-profileLabelsR">D.O.B:</p>
                    <p class="ptk-profileDetails">{{ user.birthday }}</p>
                </div>
                <div class="ptk-profileDetailsRow">
                    <p class="ptk-profileLabelsR">Email:</p>
                    <p class="ptk-profileDetails">{{ user.email }}</p>
                </div>
            </div>
        </div>
        {% if app.user.id == user.id %}
            <a class="ptk-modalShow">
                <img class="ptk-editProfileIcon" src="{{ asset('build/images/editProfile.png') }}" alt="edit profile"/>
            </a>
        {% endif %}
    </div>
{% endblock %}

{% block filters %}

    <div class="ptk-userFilterContainer">
        <div class="ptk-filterDataType">
            <div class="ptk-dropdownDatatype">
                <div class="ptk-ptk-dropDownbtnContainer">
                    <button class="ptk-dropDownbtn">
                        <span class="ptk-linksHover">Filter by: <span class="ptk-dropDownLabel"> {{app.request.get('dataType')}}</span></span>
                    </button>
                </div>
                <div class="ptk-dropdownContent">
                    <a href="{{ path('app_user_show', {id: user.id, 'orderBy': app.request.get('orderBy'), 'dataType': 'Projects and Ideas'}) }}">Projects and Ideas</a>
                    <a href="{{ path('app_user_show', {id: user.id, 'orderBy': app.request.get('orderBy'), 'dataType': 'Projects'}) }}">Projects</a>
                    <a href="{{ path('app_user_show', {id: user.id, 'orderBy': app.request.get('orderBy'), 'dataType': 'Ideas'}) }}">Ideas</a>
                </div>
            </div>
        </div>
        <div class="ptk-filtersOrderBy">
            <p class="ptk-filterSeparators ptk-filtersWhite"> Order by: </p>
            <a href="{{ path('app_user_show', {id: user.id, 'orderBy': 'newest', 'dataType': app.request.get('dataType')}) }}" class="ptk-filterLinks">
                <span class="ptk-linksHover">newest</span></a>
            <p class="ptk-filterSeparators"> / </p>
            <a href="{{ path('app_user_show', {id: user.id, 'orderBy': 'oldest', 'dataType': app.request.get('dataType')}) }}" class="ptk-filterLinks">
                <span class="ptk-linksHover">oldest</span></a>
            <p class="ptk-filterSeparators"> / </p>
            <a href="{{ path('app_user_show', {id: user.id, 'orderBy': 'views', 'dataType': app.request.get('dataType')}) }}" class="ptk-filterLinks">
                <span class="ptk-linksHover">views</span></a>
        </div>
    </div>
{% endblock %}

{% block modal %}
    {% include '/user/edit.html.twig' %}
{% endblock %}

{% block javascripts %}
    <script>
        let modals = document.querySelectorAll(".ptk-modalContainer");
        let showModalsLink = document.querySelectorAll(".ptk-modalShow");
        let hideModalsLink = document.querySelectorAll(".ptk-formCloseBttn");
        let formLoad = document.querySelectorAll(".ptk-profileFormContainer");
        let formClose = document.querySelectorAll(".ptk-formBttns");

        hideModalsLink.forEach((hlink, index) => {
            hlink.addEventListener("click", function(e) {
                modals[0].classList.remove("ptk-modalContainerShow");
                formLoad[0].classList.remove("ptk-formContainerShow");
                console.log(hideModalsLink);
            });
        })

        showModalsLink.forEach((link, index) => {
            link.addEventListener("click", function(e) {
                modals[0].classList.add("ptk-modalContainerShow");
                formLoad[0].classList.add("ptk-formContainerShow");
                console.log(modals);
            });
        })

        let flashMessages = document.querySelectorAll(".ptk-flashMessages");
        function fadeOutEffect() {
            flashMessages.forEach((msgs, index) => {// index will be current button index

                let fadeEffect = setInterval(function () {
                    if (!msgs.style.opacity) {
                        msgs.style.opacity = 1;
                    }
                    if (msgs.style.opacity > 0) {
                        msgs.style.opacity = 0;
                    }
                }, 2500);
            })
        }
        window.onload = fadeOutEffect;
    </script>
{% endblock %}

{% block body %}
    <div class="ptk-cardsBlock">
        <div class="ptk-ideaCardsContainer">
            {% if projectsIdeas|length > 0 %}
                {% for projectIdea in projectsIdeas %}
                    {% if projectIdea.dataType == 'idea' %}
                        {# ------------ Idea cards --------------------------------------------------------------- #}
                        <div class="ptk-profileCardContainer">
                            <p class="ptk-profileCardTypeLabel">Idea</p>
                                <div class="ptk-ideaCards" style="border: 2.5px solid {{projectIdea.color}}">
                                    <a href="{{ path('app_idea_show', {'id': projectIdea.id}) }}" class="ptk-cardsLink">
                                    <div class="ptk-cardIdeaTitleContainer">
                                        <h1 class="ptk-cardIdeaTitle">{{ projectIdea.title|striptags|length > 40 ? projectIdea.title|striptags|slice(0, 40) ~ '...' : projectIdea.title|striptags }}</h1>
                                    </div>
                                    </a>
                                    <div class="ptk-cardIdeaStatsContainer">
                                        <div class="ptk-cardStatsContainer">
                                            <div class="ptk-cardIconStats">
                                                {% if projectIdea.liked == 1 %}
                                                    <a href="{{ path('app_idea_dislike', {'id': projectIdea.id, 'orderBy': app.request.get('orderBy'), 'dataType': app.request.get('dataType')}) }}" class="ptk-cardsLink">
                                                        <img src="{{ asset('build/images/blackheart.png') }}" class="ptk-ideaInfoIcons" alt="Dislike">
                                                    </a>
                                                {% else %}
                                                    <a href="{{ path('app_idea_like', {'id': projectIdea.id, 'orderBy': app.request.get('orderBy'), 'dataType': app.request.get('dataType')}) }}" class="ptk-cardsLink">
                                                        <img src="{{ asset('build/images/like.png') }}" class="ptk-ideaInfoIcons" alt="Like">
                                                    </a>
                                                {% endif %}
                                                <p class="ptk-cardStatsNo">{{ projectIdea.likes }}</p>
                                            </div>
                                            <div class="ptk-cardIconStats">
                                                <img src="{{ asset('build/images/comment.png') }}" class="ptk-ideaInfoIcons" alt="Comments">
                                                <p class="ptk-cardStatsNo">{{ projectIdea.counts }}</p>
                                            </div>
                                            <div class="ptk-cardIconStats">
                                                <img src="{{ asset('build/images/view.png') }}" class="ptk-ideaInfoIcons" alt="Views">
                                                <p class="ptk-cardStatsNo">{{ projectIdea.views }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        {% endif %}
                        {% if projectIdea.dataType == 'project' %}
                            {# ------------ Project cards --------------------------------------------------------------- #}
                            <div class="ptk-profileCardContainer">
                                <p class="ptk-profileCardTypeLabel">Project</p>
                                <a href="{{ path('app_project_show', {'id': projectIdea.id, 'orderBy': 'show'}) }}" class="ptk-cardsLink">
                                    <div class="ptk-cards">
                                        <div class="ptk-cardTitleContainer">
                                            <h1 class="ptk-cardTitle">{{ projectIdea.title|striptags|length > 40 ? projectIdea.title|striptags|slice(0, 40) ~ '...' : projectIdea.title|striptags }}</h1>
                                        </div>
                                        <div class="ptk-cardStatsContainer" style="background-color: {{ projectIdea.color }}">
                                            <div class="ptk-cardIconStats">
                                                <img src="{{ asset('build/images/idea.png') }}" alt="idea">
                                                <p class="ptk-cardStatsNo">{{ projectIdea.counts is null ? 0 : projectIdea.counts }}</p>
                                            </div>
                                            <div class="ptk-cardIconStats">
                                                <img src="{{ asset('build/images/view.png') }}" class="ptk-ideaInfoIcons"
                                                     alt="Views">
                                                <p class="ptk-cardStatsNo">{{ projectIdea.views is null ? 0 : projectIdea.views }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                    {% endif %}
                {% endfor %}
            {% else %}
{#             ----------- if there are no Ideas or projects --- -------#}
                <div class="ptk-ideaNoDataContainer">
                    <h1 class="ptk-noDataTitle">No projects or ideas yet</h1>
                </div>
            {% endif %}
        </div>

    </div>
{% endblock %}
